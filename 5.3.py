import numpy as np

# =====================================
# 1. Дані (таблиця 5.4)
# =====================================
data = np.array([
    [71.2, 54.7, 128, 38995, 10.43, 412.8, 3436, 101.6, 21.0, 17.9, 287],
    [71.6, 55.56, 120.1, 13636, 14.92, 452.7, 3899, 130.408, 19.0, 18.26, 282.56],
    [74.25, 55.49, 114.4, 12905, 12.11, 410.2, 4644, 101.306, 18.0, 18.71, 281.05],
    [74.25, 56.12, 113.9, 13271, 18.67, 458.6, 2051, 141.993, 26.0, 19.69, 283.68],
    [78.38, 61.78, 116.8, 26785, 56.83, 518.6, 2562, 385.409, 36.0, 20.19, 299.65],
    [82.2, 64.22, 115.3, 30437, 80.62, 555.9, 2855, 482.03, 15.3, 20.42, 307.13],
    [84.28, 65.32, 120.1, 42156, 18.65, 458.6, 2855, 141.932, 16.25, 20.89, 316.85],
    [86.08, 68.48, 121.0, 12936, 34.30, 483.1, 2891, 222.11, 17.64, 20.90, 324.33],
    [87.94, 71.8, 125.8, 23894, 41.60, 494.6, 3512, 274.297, 19.23, 21.48, 336.90],
    [89.43, 74.24, 127.8, 25355, 34.31, 483.2, 1251, 222.196, 19.74, 21.53, 343.80],
    [104.6, 98.9, 147.9, 38759, 28.2, 473.6, 3299, 185.061, 26.45, 26.83, 421.71]
])

# =====================================
# 2. Формування X та Y
# =====================================
X = data[:, :-1]
y = data[:, -1]

feature_names = [f"X{i+1}" for i in range(X.shape[1])]

# =====================================
# 3. Нормування (0..1)
# =====================================
X_norm = (X - X.min(axis=0)) / (X.max(axis=0) - X.min(axis=0))
y_norm = (y - y.min()) / (y.max() - y.min())

# =====================================
# 4. Box-counting параметри
# =====================================
epsilon = 0.1

def box_count_1d(x, eps):
    boxes = np.floor(x / eps)
    return np.log(len(np.unique(boxes)))

def box_count_2d(x, y, eps):
    bx = np.floor(x / eps)
    by = np.floor(y / eps)
    pairs = np.unique(np.column_stack((bx, by)), axis=0)
    return np.log(len(pairs))

# =====================================
# 5. Оцінка інформативності факторів
# =====================================
info = []

for i in range(X_norm.shape[1]):
    val = box_count_2d(X_norm[:, i], y_norm, epsilon)
    info.append((feature_names[i], val))

info.sort(key=lambda x: x[1], reverse=True)

# =====================================
# 6. Вивід результатів
# =====================================
print("Інформативність факторів (box-counting):")
print("-" * 45)

for name, score in info:
    print(f"{name:4s} : {score:.4f}")
